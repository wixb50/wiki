<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>MySQL - Wiki · Elegancetse Tse</title>
    <meta name="keywords" content="wiki, makrdown, linux, python, ops, simiki"/>
    <meta name="description" content="Stay hungry,Stay foolish."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/wiki/">Wiki · Elegancetse Tse</a>
    &nbsp;&#187;&nbsp;
    <a href="/wiki/#database">database</a>
    &nbsp;&#187;&nbsp;MySQL
    <span class="updated">Updated&nbsp;
    2013-08-17 07:36
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">常用命令</a></li>
<li><a href="#_2">问题</a><ul>
<li><a href="#_3">无法删除数据库</a></li>
<li><a href="#_4">查看单个数据库或表的大小</a></li>
<li><a href="#dot">创建名称带点号(dot)的数据库</a></li>
</ul>
</li>
</ul>
</div>
<p><code>&lt;&gt;</code> 括起来的表示变量, 根据实际情况而定。</p>
<h2 id="_1">常用命令</h2>
<p>查看mysql用户:</p>
<div class="hlcode"><pre><span class="n">SELECT</span> <span class="n">User</span><span class="p">,</span> <span class="n">Host</span> <span class="n">FROM</span> <span class="n">mysql</span><span class="p">.</span><span class="n">user</span><span class="p">;</span>
</pre></div>


<p>带上主机是因为用户和主机是相关的，否则意义不大，会显示多个相同的用户。</p>
<p>如果要显示唯一的用户:</p>
<div class="hlcode"><pre><span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">User</span> <span class="n">FROm</span> <span class="n">mysql</span><span class="p">.</span><span class="n">user</span><span class="p">;</span>
</pre></div>


<p>删除用户:</p>
<div class="hlcode"><pre><span class="nx">DROP</span> <span class="nb">USER</span> <span class="s1">&#39;&lt;username&gt;&#39;</span><span class="p">@</span><span class="s1">&#39;&lt;host&gt;&#39;</span><span class="p">;</span>
</pre></div>


<p>带上引号是个好习惯, 否则主机名包含<code>-</code>等符号必须用引号阔起来。</p>
<p>创建用户:</p>
<div class="hlcode"><pre><span class="nb">CREATE</span> <span class="nb">USER</span> <span class="s1">&#39;&lt;username&gt;&#39;</span><span class="p">@</span><span class="s1">&#39;&lt;host&gt;&#39;</span> <span class="nx">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">&#39;&lt;password&gt;&#39;</span><span class="p">;</span>
</pre></div>


<p>查看指定用户@主机的权限:</p>
<div class="hlcode"><pre><span class="nx">SHOW</span> <span class="nx">GRANTS</span> <span class="nb">FOR</span> <span class="s1">&#39;&lt;username&gt;&#39;</span><span class="p">@</span><span class="o">&lt;</span><span class="nb">host</span><span class="o">&gt;</span><span class="p">;</span>

<span class="nx">mysql</span><span class="o">&gt;</span> <span class="nx">SHOW</span> <span class="nx">GRANTS</span> <span class="nb">FOR</span> <span class="nx">tankywoo</span><span class="p">@</span><span class="nx">localhost</span><span class="p">;</span>
<span class="o">+-------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="nx">Grants</span> <span class="nb">for</span> <span class="nx">blog1</span><span class="p">@</span><span class="nx">localhost</span>                                                    <span class="o">|</span>
<span class="o">+-------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="nx">GRANT</span> <span class="nb">USAGE</span> <span class="k">ON</span> <span class="o">*</span><span class="nx">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">&#39;tankywoo&#39;</span><span class="p">@</span><span class="s1">&#39;localhost&#39;</span> <span class="nx">IDENTIFIED</span> <span class="k">BY</span> <span class="nx">PASSWORD</span> <span class="s1">&#39;*xxxxxx&#39;</span> <span class="o">|</span>
<span class="o">+-------------------------------------------------------------------------------+</span>
<span class="mi">1</span> <span class="n">row</span> <span class="k">in</span> <span class="nb">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="nx">sec</span><span class="p">)</span>
</pre></div>


<p><code>USAGE</code>表示没有任何权限。</p>
<p>给用户赋予权限:</p>
<div class="hlcode"><pre><span class="nx">GRANT</span> <span class="o">&lt;</span><span class="nx">privilege</span><span class="o">&gt;</span> <span class="k">ON</span> <span class="o">&lt;</span><span class="nx">database</span><span class="o">&gt;</span><span class="nx">.</span><span class="o">&lt;</span><span class="nb">table</span><span class="o">&gt;</span> <span class="k">TO</span> <span class="s1">&#39;&lt;username&gt;&#39;</span><span class="p">@</span><span class="s1">&#39;&lt;host&gt;&#39;</span><span class="p">;</span>
</pre></div>


<p>如给用户设置所有权限给所有数据库:</p>
<div class="hlcode"><pre><span class="n">GRANT</span> <span class="n">ALL</span> <span class="n">ON</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="n">TO</span> <span class="err">&#39;</span><span class="n">tankywoo</span><span class="sc">&#39;@&#39;</span><span class="n">localhost</span><span class="err">&#39;</span><span class="p">;</span>
</pre></div>


<p>赋予所有权限给指定的数据库:</p>
<div class="hlcode"><pre><span class="n">GRANT</span> <span class="n">ALL</span> <span class="n">ON</span> <span class="n">testdb</span><span class="p">.</span><span class="o">*</span> <span class="n">TO</span> <span class="err">&#39;</span><span class="n">tankywoo</span><span class="sc">&#39;@&#39;</span><span class="n">localhost</span><span class="err">&#39;</span><span class="p">;</span>
</pre></div>


<p>赋予所有权限给指定的数据库的某个表:</p>
<div class="hlcode"><pre><span class="n">GRANT</span> <span class="n">ALL</span> <span class="n">ON</span> <span class="n">testdb</span><span class="p">.</span><span class="n">testtable</span> <span class="n">TO</span> <span class="err">&#39;</span><span class="n">tankywoo</span><span class="sc">&#39;@&#39;</span><span class="n">localhost</span><span class="err">&#39;</span><span class="p">;</span>
</pre></div>


<p>赋予查询,插入权限给指定的数据库的某个表:</p>
<div class="hlcode"><pre><span class="n">GRANT</span> <span class="n">SELECT</span><span class="p">,</span><span class="n">INSERT</span> <span class="n">ON</span> <span class="n">testdb</span><span class="p">.</span><span class="n">testtable</span> <span class="n">TO</span> <span class="err">&#39;</span><span class="n">tankywoo</span><span class="sc">&#39;@&#39;</span><span class="n">localhost</span><span class="err">&#39;</span><span class="p">;</span>
</pre></div>


<p><strong>注意</strong>: <code>grant</code>命令赋予权限也可以创建用户, 比如上面如果tankywoo@localhost不存在, 则会创建此用户。所以一定要注意host, 如果赋予权限时忘了带上host, 则默认会创建user@%.</p>
<p>赋予权限后刷新权限是个好习惯:</p>
<div class="hlcode"><pre><span class="n">FLUSH</span> <span class="n">PRIVILEGES</span><span class="p">;</span>
</pre></div>


<p>修改用户密码:</p>
<div class="hlcode"><pre><span class="nb">SET</span> <span class="nx">PASSWORD</span> <span class="nb">FOR</span> <span class="s1">&#39;&lt;username&gt;&#39;</span><span class="p">@</span><span class="s1">&#39;&lt;host&gt;&#39;</span> <span class="o">=</span> <span class="nx">Password</span><span class="p">(</span><span class="s1">&#39;&lt;password&gt;&#39;</span><span class="p">);</span>
</pre></div>


<p><code>Password()</code>函数用来给密码加密。</p>
<h2 id="_2">问题</h2>
<h3 id="_3">无法删除数据库</h3>
<p>删除数据库时报错:</p>
<div class="hlcode"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">drop</span> <span class="n">database</span> <span class="n">testdb</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1010</span> <span class="p">(</span><span class="n">HY000</span><span class="p">)</span><span class="o">:</span> <span class="n">Error</span> <span class="n">dropping</span> <span class="n">database</span> <span class="p">(</span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">rmdir</span> <span class="err">&#39;</span><span class="p">.</span><span class="o">/</span><span class="n">testdb</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">errno</span><span class="o">:</span> <span class="mi">39</span><span class="p">)</span>
</pre></div>


<p>之前数据库有问题, 不确定是异常退出还是升级导致, binlog问题导致mysqld启动不了, 于是删除了binlog等问题, 可能和这块有关。</p>
<p>最后手动把数据库目录删除了。暂时没去查这个错误码的意义。</p>
<p>参考: <a href="http://stackoverflow.com/questions/4584458/error-dropping-database-cant-rmdir-test-errno-17">Error Dropping Database (Can't rmdir '.test\', errno: 17)</a></p>
<h3 id="_4">查看单个数据库或表的大小</h3>
<p>要想知道每个数据库的大小的话，步骤如下：</p>
<p>1、进入<code>information_schema</code> 数据库（存放了其他的数据库的信息）</p>
<div class="hlcode"><pre><span class="n">use</span> <span class="n">information_schema</span><span class="p">;</span>
</pre></div>


<p>2、查询所有数据的大小：</p>
<div class="hlcode"><pre><span class="n">select</span> <span class="n">concat</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="n">data_length</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="err">&#39;</span><span class="n">MB</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="n">data</span> <span class="n">from</span> <span class="n">tables</span><span class="p">;</span>
</pre></div>


<p>3、查看指定数据库的大小：</p>
<p>比如查看数据库home的大小</p>
<div class="hlcode"><pre><span class="n">select</span> <span class="n">concat</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="n">data_length</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="err">&#39;</span><span class="n">MB</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="n">data</span> <span class="n">from</span> <span class="n">tables</span> <span class="n">where</span> <span class="n">table_schema</span><span class="o">=</span><span class="err">&#39;</span><span class="n">home</span><span class="err">&#39;</span><span class="p">;</span>
</pre></div>


<p>4、查看指定数据库的某个表的大小</p>
<p>比如查看数据库home中 members 表的大小</p>
<div class="hlcode"><pre><span class="n">select</span> <span class="n">concat</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="n">data_length</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="err">&#39;</span><span class="n">MB</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="n">data</span> <span class="n">from</span> <span class="n">tables</span> <span class="n">where</span> <span class="n">table_schema</span><span class="o">=</span><span class="err">&#39;</span><span class="n">home</span><span class="err">&#39;</span> <span class="n">and</span> <span class="n">table_name</span><span class="o">=</span><span class="err">&#39;</span><span class="n">members</span><span class="err">&#39;</span><span class="p">;</span>
</pre></div>


<p>(转载至网上)</p>
<h3 id="dot">创建名称带点号(dot)的数据库</h3>
<p>如创建叫 www.xxx.com 的数据库:</p>
<div class="hlcode"><pre><span class="n">CREATE</span> <span class="n">DATABASE</span> <span class="err">`</span><span class="n">www</span><span class="p">.</span><span class="n">xxx</span><span class="p">.</span><span class="n">com</span><span class="err">`</span>
</pre></div>


<p>引号不行, 要用双引号。</p>
<p>在<a href="https://bytes.com/topic/mysql/answers/75624-how-do-you-create-database-dash-name#post260958">这个回答</a>上看到, 不过还没看到权威文档说明。</p>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2016 Elegancetse Tse.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://git.coding.net/tankywoo/yasimple_x2.git" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Site Generated 2016-12-03 14:27:44</p>
      </div> <!-- end footer-right -->
    </div>
  </body>
</html>