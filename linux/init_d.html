<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>init.d - Wiki · Elegancetse Tse</title>
    <meta name="keywords" content="wiki, makrdown, linux, python, ops, simiki"/>
    <meta name="description" content="Stay hungry,Stay foolish."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/wiki/">Wiki · Elegancetse Tse</a>
    &nbsp;&#187;&nbsp;
    <a href="/wiki/#linux">linux</a>
    &nbsp;&#187;&nbsp;init.d
    <span class="updated">Updated&nbsp;
    2018-05-07 09:29
    
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#initd">init.d服务管理</a><ul>
<li><a href="#etcinitd">关于/etc/init.d</a></li>
<li><a href="#initredis">自定义一个init服务(redis为例)</a></li>
<li><a href="#chkconfig">chkconfig命令</a></li>
</ul>
</li>
<li><a href="#etcrclocal">关于/etc/rc.local</a></li>
<li><a href="#_1">参考文档</a></li>
</ul>
</div>
<h2 id="initd"><code>init.d</code>服务管理</h2>
<h3 id="etcinitd">关于<code>/etc/init.d</code></h3>
<p>当你查看/etc目录时，你会发现许多rc#.d 形式存在的目录（这里#代表一个指定的初始化级别，范围是0~6）。在这些目录之下，包含了许多对进程进行控制的脚本。这些脚本要么以"K"开头，要么以"S"开头。以K开头的脚本运行在以S开头的脚本之前。这些脚本放置的地方，将决定这些脚本什么时候开始运行。在这些目录之间，系统服务一起合作，就像运行状况良好的机器一样。然而，有时候你希望能在不使用kill 或killall 命令的情况下，能干净的启动或杀死一个进程。这就是/etc/init.d能够派上用场的地方了！</p>
<div class="hlcode"><pre><span class="err">如果你在使用</span><span class="n">Fedora</span><span class="err">系统，你可以找到这个目录：</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="err">。实际上无论</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="err">放在什么地方，它都发挥着相同的作用。</span>
</pre></div>


<div class="hlcode"><pre><span class="cp"># init相关命令</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">service</span> <span class="p">[</span><span class="n">start</span><span class="o">|</span><span class="n">stop</span><span class="o">|</span><span class="n">reload</span><span class="o">|</span><span class="n">restart</span><span class="o">|</span><span class="n">force</span><span class="p">]</span>
</pre></div>


<h3 id="initredis">自定义一个init服务(redis为例)</h3>
<p>新建/etc/init.d/redisd脚本</p>
<table class="hlcodetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="hlcode"><pre><span class="c">#!/bin/sh</span>
<span class="c"># chkconfig:   2345 90 10</span>
<span class="c"># description:  Redis is a persistent key-value database</span>
<span class="c">#</span>
<span class="c"># Simple Redis init.d script conceived to work on Linux systems</span>
<span class="c"># as it does use of the /proc filesystem.</span>

<span class="nv">REDISPORT</span><span class="o">=</span>6379
<span class="nv">EXEC</span><span class="o">=</span>/usr/bin/redis-server
<span class="nv">CLIEXEC</span><span class="o">=</span>/usr/bin/redis-cli

<span class="nv">PIDFILE</span><span class="o">=</span>/var/run/redis_<span class="k">${</span><span class="nv">REDISPORT</span><span class="k">}</span>.pid
<span class="nv">CONF</span><span class="o">=</span><span class="s2">&quot;/etc/redis/${REDISPORT}.conf&quot;</span>

<span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
    start<span class="o">)</span>
        <span class="k">if</span> <span class="o">[</span> -f <span class="nv">$PIDFILE</span> <span class="o">]</span>
        <span class="k">then</span>
<span class="k">                </span><span class="nb">echo</span> <span class="s2">&quot;$PIDFILE exists, process is already running or crashed&quot;</span>
        <span class="k">else</span>
<span class="k">                </span><span class="nb">echo</span> <span class="s2">&quot;Starting Redis server...&quot;</span>
                <span class="nv">$EXEC</span> <span class="nv">$CONF</span>
        <span class="k">fi</span>
        ;;
    stop<span class="o">)</span>
        <span class="k">if</span> <span class="o">[</span> ! -f <span class="nv">$PIDFILE</span> <span class="o">]</span>
        <span class="k">then</span>
<span class="k">                </span><span class="nb">echo</span> <span class="s2">&quot;$PIDFILE does not exist, process is not running&quot;</span>
        <span class="k">else</span>
<span class="k">                </span><span class="nv">PID</span><span class="o">=</span><span class="k">$(</span>cat <span class="nv">$PIDFILE</span><span class="k">)</span>
                <span class="nb">echo</span> <span class="s2">&quot;Stopping ...&quot;</span>
                <span class="nv">$CLIEXEC</span> -p <span class="nv">$REDISPORT</span> -a 123456 shutdown
                <span class="k">while</span> <span class="o">[</span> -x /proc/<span class="k">${</span><span class="nv">PID</span><span class="k">}</span> <span class="o">]</span>
                <span class="k">do</span>
<span class="k">                    </span><span class="nb">echo</span> <span class="s2">&quot;Waiting for Redis to shutdown ...&quot;</span>
                    sleep 1
                <span class="k">done</span>
<span class="k">                </span><span class="nb">echo</span> <span class="s2">&quot;Redis stopped&quot;</span>
        <span class="k">fi</span>
        ;;
    *<span class="o">)</span>
        <span class="nb">echo</span> <span class="s2">&quot;Please use start or stop as first argument&quot;</span>
        ;;
<span class="k">esac</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>其中chkconfig各字段意义如下：</p>
</blockquote>
<div class="hlcode"><pre><span class="mi">2345</span><span class="err">：在</span><span class="mi">2</span><span class="err">、</span><span class="mi">3</span><span class="err">、</span><span class="mi">4</span><span class="err">、</span><span class="mi">5</span><span class="err">级别（级别见下文说明）启动</span><span class="n">redis</span>
<span class="mi">60</span><span class="err">：启动顺序为</span><span class="mi">60</span><span class="err">号，</span><span class="n">S60</span>
<span class="mi">10</span><span class="err">：关闭顺序为</span><span class="mi">10</span><span class="err">号，</span><span class="n">K10</span>
<span class="err">当进行</span><span class="n">chkconfig</span> <span class="o">--</span><span class="n">add</span> <span class="n">httpd</span><span class="err">操作时，如果没有指定</span><span class="n">level</span><span class="err">那么就会来这个注释中取值</span>
</pre></div>


<p>执行下列命令</p>
<div class="hlcode"><pre><span class="n">chkconfig</span> <span class="n">redisd</span> <span class="n">on</span>
<span class="n">service</span> <span class="n">redisd</span> <span class="n">start</span> <span class="err">#</span> <span class="err">打开</span> <span class="n">redis</span> <span class="err">服务</span>
<span class="n">service</span> <span class="n">redisd</span> <span class="n">stop</span> <span class="err">#</span> <span class="err">关闭</span> <span class="n">redis</span> <span class="err">服务</span>
</pre></div>


<h3 id="chkconfig">chkconfig命令</h3>
<p>chkconfig命令主要用来更新（启动或停止）和查询系统服务的运行级信息。谨记chkconfig不是立即自动禁止或激活一个服务，它只是简单的改变了符号连接。</p>
<p>使用语法：</p>
<div class="hlcode"><pre><span class="n">chkconfig</span> <span class="p">[</span><span class="o">--</span><span class="n">add</span><span class="p">][</span><span class="o">--</span><span class="n">del</span><span class="p">][</span><span class="o">--</span><span class="n">list</span><span class="p">][</span><span class="err">系统服务</span><span class="p">]</span> <span class="err">或</span> <span class="n">chkconfig</span> <span class="p">[</span><span class="o">--</span><span class="n">level</span> <span class="o">&lt;</span><span class="err">等级代号</span><span class="o">&gt;</span><span class="p">][</span><span class="err">系统服务</span><span class="p">][</span><span class="n">on</span><span class="o">/</span><span class="n">off</span><span class="o">/</span><span class="n">reset</span><span class="p">]</span>
</pre></div>


<p>参数用法：</p>
<div class="hlcode"><pre><span class="o">--</span><span class="n">add</span> <span class="err">　增加所指定的系统服务，让</span><span class="n">chkconfig</span><span class="err">指令得以管理它，并同时在系统启动的叙述文件内增加相关数据。</span>
<span class="o">--</span><span class="n">del</span> <span class="err">　删除所指定的系统服务，不再由</span><span class="n">chkconfig</span><span class="err">指令管理，并同时在系统启动的叙述文件内删除相关数据。</span>
<span class="o">--</span><span class="n">level</span><span class="o">&lt;</span><span class="err">等级代号</span><span class="o">&gt;</span> <span class="err">　指定读系统服务要在哪一个执行等级中开启或关毕。</span>
  <span class="err">等级</span><span class="mi">0</span><span class="err">表示：表示关机</span>
  <span class="err">等级</span><span class="mi">1</span><span class="err">表示：单用户模式</span>
  <span class="err">等级</span><span class="mi">2</span><span class="err">表示：无网络连接的多用户命令行模式</span>
  <span class="err">等级</span><span class="mi">3</span><span class="err">表示：有网络连接的多用户命令行模式</span>
  <span class="err">等级</span><span class="mi">4</span><span class="err">表示：不可用</span>
  <span class="err">等级</span><span class="mi">5</span><span class="err">表示：带图形界面的多用户模式</span>
  <span class="err">等级</span><span class="mi">6</span><span class="err">表示：重新启动</span>
  <span class="err">需要说明的是，</span><span class="n">level</span><span class="err">选项可以指定要查看的运行级而不一定是当前运行级。对于每个运行级，只能有一个启动脚本或者停止脚本。当切换运行级时，</span><span class="n">init</span><span class="err">不会重新启动已经启动的服务，也不会再次去停止已经停止的服务。</span>

<span class="n">chkconfig</span> <span class="o">--</span><span class="n">list</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="err">：显示所有运行级系统服务的运行状态信息（</span><span class="n">on</span><span class="err">或</span><span class="n">off</span><span class="err">）。如果指定了</span><span class="n">name</span><span class="err">，那么只显示指定的服务在不同运行级的状态。</span>
<span class="n">chkconfig</span> <span class="o">--</span><span class="n">add</span> <span class="n">name</span><span class="err">：增加一项新的服务。</span><span class="n">chkconfig</span><span class="err">确保每个运行级有一项启动</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="err">或者杀死</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="err">入口。如有缺少，则会从缺省的</span><span class="n">init</span><span class="err">脚本自动建立。</span>
<span class="n">chkconfig</span> <span class="o">--</span><span class="n">del</span> <span class="n">name</span><span class="err">：删除服务，并把相关符号连接从</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">6</span><span class="p">].</span><span class="n">d</span><span class="err">删除。</span>
<span class="n">chkconfig</span> <span class="p">[</span><span class="o">--</span><span class="n">level</span> <span class="n">levels</span><span class="p">]</span> <span class="n">name</span><span class="err">：设置某一服务在指定的运行级是被启动，停止还是重置。</span>
</pre></div>


<p>运行级文件：</p>
<p>每个被chkconfig管理的服务需要在对应的init.d下的脚本加上两行或者更多行的注释。第一行告诉chkconfig缺省启动的运行级以及启动和停止的优先级。如果某服务缺省不在任何运行级启动，那么使用 - 代替运行级。第二行对服务进行描述，可以用\ 跨行注释。<br />
例如，random.init包含三行：</p>
<div class="hlcode"><pre><span class="c"># chkconfig: 2345 20 80</span>
<span class="c"># description: Saves and restores system entropy pool for \</span>
<span class="c"># higher quality random number generation.</span>
</pre></div>


<p>使用范例：</p>
<div class="hlcode"><pre><span class="n">chkconfig</span> <span class="o">--</span><span class="n">list</span>        <span class="err">#列出所有的系统服务</span>
<span class="n">chkconfig</span> <span class="o">--</span><span class="n">add</span> <span class="n">httpd</span>        <span class="err">#增加</span><span class="n">httpd</span><span class="err">服务</span>
<span class="n">chkconfig</span> <span class="o">--</span><span class="n">del</span> <span class="n">httpd</span>        <span class="err">#删除</span><span class="n">httpd</span><span class="err">服务</span>
<span class="n">chkconfig</span> <span class="o">--</span><span class="n">level</span> <span class="n">httpd</span> <span class="mi">2345</span> <span class="n">on</span>        <span class="err">#设置</span><span class="n">httpd</span><span class="err">在运行级别为</span><span class="mi">2</span><span class="err">、</span><span class="mi">3</span><span class="err">、</span><span class="mi">4</span><span class="err">、</span><span class="mi">5</span><span class="err">的情况下都是</span><span class="n">on</span><span class="err">（开启）的状态</span>
<span class="n">chkconfig</span> <span class="o">--</span><span class="n">list</span>        <span class="err">#列出系统所有的服务启动情况</span>
<span class="n">chkconfig</span> <span class="o">--</span><span class="n">list</span> <span class="n">mysqld</span>        <span class="err">#列出</span><span class="n">mysqld</span><span class="err">服务设置情况</span>
<span class="n">chkconfig</span> <span class="o">--</span><span class="n">level</span> <span class="mi">35</span> <span class="n">mysqld</span> <span class="n">on</span>        <span class="err">#设定</span><span class="n">mysqld</span><span class="err">在等级</span><span class="mi">3</span><span class="err">和</span><span class="mi">5</span><span class="err">为开机运行服务，</span><span class="o">--</span><span class="n">level</span> <span class="mi">35</span><span class="err">表示操作只在等级</span><span class="mi">3</span><span class="err">和</span><span class="mi">5</span><span class="err">执行，</span><span class="n">on</span><span class="err">表示启动，</span><span class="n">off</span><span class="err">表示关闭</span>
<span class="n">chkconfig</span> <span class="n">mysqld</span> <span class="n">on</span>        <span class="err">#设定</span><span class="n">mysqld</span><span class="err">在各等级为</span><span class="n">on</span><span class="err">，“各等级”包括</span><span class="mi">2</span><span class="err">、</span><span class="mi">3</span><span class="err">、</span><span class="mi">4</span><span class="err">、</span><span class="mi">5</span><span class="err">等级</span>
</pre></div>


<p>如何增加一个服务：</p>
<ol>
<li>服务脚本必须存放在<code>/etc/ini.d/</code>目录下；</li>
<li><code>chkconfig --add servicename</code>，在chkconfig工具服务列表中增加此服务，此时服务会被在<code>/etc/rc.d/rcN.d</code>中赋予K/S入口了；</li>
<li><code>chkconfig --level 35 mysqld on</code>，修改服务的默认启动等级</li>
</ol>
<h2 id="etcrclocal">关于<code>/etc/rc.local</code></h2>
<p>rc.local也是使用的一个脚本。该脚本是在系统初始化级别脚本运行之后再执行的，因此可以安全地在里面添加你想在系统启动之后执行的脚本。常见的情况是你可以再里面添加nfs挂载/mount脚本等。如下：</p>
<table class="hlcodetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="hlcode"><pre><span class="c">#!/bin/sh -e</span>
<span class="c">#</span>
<span class="c"># rc.local</span>
<span class="c">#</span>
<span class="c"># This script is executed at the end of each multiuser runlevel.</span>
<span class="c"># Make sure that the script will &quot;exit 0&quot; on success or any other</span>
<span class="c"># value on error.</span>
<span class="c">#</span>
<span class="c"># In order to enable or disable this script just change the execution</span>
<span class="c"># bits.</span>
<span class="c">#</span>
<span class="c"># By default this script does nothing.</span>

/usr/local/zookeeper-3.4.8/bin/zkServer.sh  start <span class="c"># 启动zookeeper服务</span>

<span class="nb">exit </span>0
</pre></div>
</td></tr></table>

<h2 id="_1">参考文档</h2>
<ul>
<li><a href="https://blog.csdn.net/u010297957/article/details/50751656">Linux中Apache(httpd)安装、配置、加为服务</a></li>
<li><a href="https://github.com/xuxiangwork/Sharing/wiki/Linux-%E5%AE%89%E8%A3%85-redis-%E5%B9%B6%E9%85%8D%E7%BD%AE%E6%88%90-service-%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1">Linux-安装-redis-并配置成-service-系统服务</a></li>
<li><a href="https://blog.csdn.net/acs713/article/details/7322082">理解Linux系统/etc/init.d目录和/etc/rc.local脚本</a></li>
</ul>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2018 Elegancetse Tse.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://github.com/tankywoo/yasimple_x2" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Site Generated 2018-05-06 22:17:57</p>
      </div> <!-- end footer-right -->
    </div>

    
    
  </body>
</html>