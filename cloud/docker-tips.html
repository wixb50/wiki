<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>docker tips - Wiki · Elegancetse Tse</title>
    <meta name="keywords" content="wiki, makrdown, linux, python, ops, simiki"/>
    <meta name="description" content="Stay hungry,Stay foolish."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/wiki/">Wiki · Elegancetse Tse</a>
    &nbsp;&#187;&nbsp;
    <a href="/wiki/#cloud">cloud</a>
    &nbsp;&#187;&nbsp;docker tips
    <span class="updated">Updated&nbsp;
    2016-08-05 18:32
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <h2 id="_1">安装</h2>
<div class="hlcode"><pre><span class="n">curl</span> <span class="o">-</span><span class="n">sSL</span> <span class="n">https</span><span class="o">:</span><span class="c1">//get.docker.com/ | sh</span>
</pre></div>


<p>官方也提供了内核参数检查的脚本 <a href="https://github.com/docker/docker/blob/master/contrib/check-config.sh">docker/contrib/check-config.sh</a></p>
<h2 id="dockerv112">dockerv1.12</h2>
<ul>
<li>https://yq.aliyun.com/articles/57576</li>
<li>engine自带swarm</li>
<li>离线deb包: https://apt.dockerproject.org/repo/pool/main/d/docker-engine/  </li>
</ul>
<h2 id="docker">搭建docker私有仓库：</h2>
<ul>
<li><a href="http://www.zimug.com/317.html">自己搭建registry v2</a> (OK)</li>
<li><a href="https://github.com/kwk/docker-registry-frontend">私有仓库web-ui</a></li>
<li><a href="https://github.com/vmware/harbor">vmware的开源私有仓库</a></li>
<li><a href="https://github.com/SUSE/Portus">Portus, Authorization service and frontend for Docker registry</a> (good)</li>
</ul>
<h2 id="docker-volume">docker volume</h2>
<ul>
<li><a href="https://yq.aliyun.com/articles/53990">Docker Volume 之权限管理</a></li>
<li><a href="https://github.com/tianon/gosu">gosu, non root use volume</a></li>
</ul>
<h2 id="docker-stats">docker stats 异常</h2>
<ul>
<li>https://github.com/docker/docker/issues/18420</li>
<li>https://github.com/docker/docker/issues/251</li>
</ul>
<h2 id="docker_1">docker代理</h2>
<ul>
<li>https://docs.docker.com/engine/admin/systemd/#http-proxy</li>
<li><a href="http://www.jianshu.com/p/ab38818ecd83">Ubuntu 15.04及后续版本Docker的代理设置</a></li>
</ul>
<h2 id="dockerfile">Dockerfile</h2>
<ul>
<li><a href="https://hujb2000.gitbooks.io/docker-flow-evolution/content/cn/basis/dockerfiledetail.html">Dockerfile文件详解</a></li>
</ul>
<h2 id="docker_2">docker工具</h2>
<ul>
<li><a href="http://www.coderli.com/config-dnsmasq-using-docker/">docker搭建dns服务器</a></li>
<li><a href="https://github.com/dawidmalina/docker-nginx-sticky">docker-nginx-sticky</a></li>
</ul>
<h2 id="docker_3">Docker二进制安装方法</h2>
<p>建议使用离线deb安装.</p>
<ul>
<li>最新官方版:https://docs.docker.com/engine/installation/binaries/    </li>
<li>实验成功:http://www.cnblogs.com/jackluo/p/5441888.html (OK)</li>
</ul>
<h2 id="docker_4">保持docker一直运行</h2>
<p>使用<code>sleep infinity</code>命令启动容器</p>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">images</span><span class="o">-</span><span class="n">name</span> <span class="n">your_image</span> <span class="n">sleep</span> <span class="n">infinity</span>
</pre></div>


<h2 id="docker_5">更改docker数据存储目录</h2>
<p>docker的默认存储路径为<code>/var/lib/docker</code>，但是有时候想更改目录：</p>
<ul>
<li>Ubuntu/Debian:编辑<code>/etc/default/docker</code>文件，更改<code>DOCKER_OPTS="-dns 8.8.8.8 -dns 8.8.4.4 -g /mnt"</code>为目录.</li>
<li>Fedora/Centos: 编辑<code>/etc/sysconfig/docker</code>文件，更改参数为<code>other_args="-g /var/lib/testdir"</code>.</li>
</ul>
<h2 id="docker_6">Docker容器内不能访问外网</h2>
<p>编辑系统网络配置</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">gedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">NetworkManager</span><span class="o">/</span><span class="n">NetworkManager</span><span class="p">.</span><span class="n">conf</span>
</pre></div>


<p>注释以下行后重启</p>
<div class="hlcode"><pre><span class="cp">#dns=dnsmasq</span>

<span class="err">$</span> <span class="n">sudo</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">manager</span> <span class="n">restart</span>
</pre></div>


<h2 id="docker0">自定义docker0网络</h2>
<p>编辑<code>/etc/docker/daemon.json</code>文件,不存在则创建</p>
<div class="hlcode"><pre><span class="p">{</span>
  <span class="s">&quot;bip&quot;</span><span class="o">:</span> <span class="s">&quot;172.33.0.1/16&quot;</span>
<span class="p">}</span>
</pre></div>


<p>重启docker进程.</p>
<h2 id="docker_7">创建自定义子网的docker网络</h2>
<div class="hlcode"><pre><span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> \
  <span class="o">--</span><span class="n">driver</span> <span class="n">overlay</span> \
  <span class="o">--</span><span class="n">subnet</span> <span class="mf">10.0.9.0</span><span class="o">/</span><span class="mi">24</span> \
  <span class="n">my</span><span class="o">-</span><span class="n">multi</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">network</span>
</pre></div>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2017 Elegancetse Tse.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://github.com/tankywoo/yasimple_x2" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Site Generated 2017-12-12 10:49:24</p>
      </div> <!-- end footer-right -->
    </div>

    
    
  </body>
</html>