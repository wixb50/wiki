<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>arp - Wiki · Elegancetse Tse</title>
    <meta name="keywords" content="wiki, makrdown, linux, python, ops, simiki"/>
    <meta name="description" content="Stay hungry,Stay foolish."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/wiki/">Wiki · Elegancetse Tse</a>
    &nbsp;&#187;&nbsp;
    <a href="/wiki/#tool">tool</a>
    &nbsp;&#187;&nbsp;arp
    <span class="updated">Updated&nbsp;
    2013-09-06 10:24
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <h1 id="arp">arp</h1>
<p>Address Resolution Protocol</p>
<h2 id="arp_1">arp 原理</h2>
<blockquote>
<p>以主机A（192.168.38.10）向主机B（192.168.38.11）发送数据为例。当发送数据时，主机A会在自己的ARP缓存表中寻找是否有目标IP地址。如果找到了，也就知道了目标MAC地址为（00-BB-00-62-C2-02），直接把目标MAC地址写入帧里面发送就可以了；如果在ARP缓存表中没有找到相对应的IP地址，主机A就会在网络上发送一个广播（ARP request），目标MAC地址是“FF.FF.FF.FF.FF.FF”，这表示向同一网段内的所有主机发出这样的询 问：“192.168.38.11的MAC地址是什么？”网络上其他主机并不响应ARP询问，只有主机B接收到这个帧时，才向主机A做出这样的回应（ARP response）：“192.168.38.11的MAC地址是（00-BB-00-62-C2-02）”。 这样，主机A就知道了主机B的MAC地址，它就可以向主机B发送信息了。同时它还更新了自己的ARP缓存表，下次再向主机B发送信息时，直接从ARP缓存表里查找就可以了。ARP缓存表采用了老化机制，在一段时间内如果表中的某一行没有使用，就会被删除，这样可以大大减少ARP缓存表的长度，加快查询速度。</p>
</blockquote>
<p>摘自<a href="http://zh.wikipedia.org/wiki/%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE">维基百科</a></p>
<h2 id="arp_2">清空所有arp缓存</h2>
<div class="hlcode"><pre><span class="n">arp</span> <span class="o">-</span><span class="n">n</span> <span class="o">|</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="o">/^</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">/</span><span class="p">{</span><span class="n">print</span> <span class="s">&quot;arp -d &quot;</span> <span class="err">$</span><span class="mi">1</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">sh</span> <span class="o">-</span><span class="n">x</span>
</pre></div>


<p>或</p>
<div class="hlcode"><pre><span class="k">for</span> <span class="n">a</span> <span class="n">in</span> <span class="err">`</span><span class="n">arp</span> <span class="o">|</span> <span class="n">grep</span> <span class="s">&quot;eth1&quot;</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">d</span> <span class="s">&quot; &quot;</span> <span class="o">-</span><span class="n">f1</span><span class="err">`</span><span class="p">;</span> <span class="k">do</span> <span class="n">arp</span> <span class="o">-</span><span class="n">d</span> <span class="err">$</span><span class="n">a</span><span class="p">;</span> <span class="n">done</span>
</pre></div>


<h2 id="arp_3">arp 缓存问题</h2>
<p>最近迁移服务器A时, 网络等都未做改动, 发现从外面的机器B可以ping通内网(走vpn), 但是ping不通外网, 而服务器A可以ping通外面, 再次从B ping A, 则可以ping通. 这就是 arp缓存 的问题, 上面的 <strong>arp 原理</strong> 算是对这个问题作了讲解. 当从 A ping 外面时, 会更新路由器上的arp缓存, 否则通过 B ping A 时, 经过路由器时只能找到 原来A的 mac 地址, 而这台机器已经没用了.</p>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2018 Elegancetse Tse.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://github.com/tankywoo/yasimple_x2" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Site Generated 2018-05-30 02:02:05</p>
      </div> <!-- end footer-right -->
    </div>

    
    
  </body>
</html>