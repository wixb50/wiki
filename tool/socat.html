<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/wiki/static/css/style.css">
    <link rel="shortcut icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/wiki/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>tcpdump - Wiki · Elegancetse Tse</title>
    <meta name="keywords" content="wiki, makrdown, linux, python, ops, simiki"/>
    <meta name="description" content="Stay hungry,Stay foolish."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/wiki/">Wiki · Elegancetse Tse</a>
    &nbsp;&#187;&nbsp;
    <a href="/wiki/#tool">tool</a>
    &nbsp;&#187;&nbsp;tcpdump
    <span class="updated">Updated&nbsp;
    2013-09-06 10:24
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <p>TODO</p>
<p>socat，是linux下的一个工具，其功能与有“瑞士军刀”之称的netcat类似，不过据说可以看做netcat的加强版。</p>
<h2 id="_1">语法</h2>
<div class="hlcode"><pre><span class="nx">socat</span> <span class="err">[</span><span class="nx">options</span><span class="cp">]</span> <span class="nt">&lt;address&gt;</span> <span class="nt">&lt;address&gt;</span>
</pre></div>


<p>其中这2个address就是关键了，如果要解释的话，address就类似于一个文件描述符，socat所做的工作就是在2个address指定的描述符间建立一个pipe用于发送和接收数据。</p>
<p>那么address的描述就是socat的精髓所在了，几个常用的描述方式如下：</p>
<ul>
<li>-,STDIN,STDOUT ：表示标准输入输出，可以就用一个横杠代替</li>
<li>/var/log/syslog : 也可以是任意路径，如果是相对路径要使用./，打开一个文件作为数据流。</li>
<li>TCP:: : 建立一个TCP连接作为数据流，TCP也可以替换为UDP</li>
<li>TCP-LISTEN: : 建立TCP监听端口，TCP也可以替换为UDP</li>
<li>EXEC: : 执行一个程序作为数据流。</li>
</ul>
<p>以上规则中前面的TCP等都可以小写。</p>
<p>在这些描述后可以附加一些选项，用逗号隔开，如fork，reuseaddr，stdin，stdout，ctty等。</p>
<h2 id="_2">使用举例</h2>
<h3 id="socatcat">socat当cat</h3>
<p>直接回显</p>
<div class="hlcode"><pre><span class="n">socat</span> <span class="o">-</span> <span class="o">-</span>
</pre></div>


<p>cat文件</p>
<div class="hlcode"><pre><span class="n">socat</span> <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">chuck</span>
</pre></div>


<p>写文件</p>
<div class="hlcode"><pre><span class="n">echo</span> <span class="s">&quot;hello&quot;</span> <span class="o">|</span> <span class="n">socat</span> <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">chuck</span>
</pre></div>


<h3 id="socatnetcat">socat当netcat</h3>
<p>连接远程端口</p>
<div class="hlcode"><pre><span class="n">nc</span> <span class="n">localhost</span> <span class="mi">80</span>
<span class="n">socat</span> <span class="o">-</span> <span class="n">TCP</span><span class="o">:</span><span class="n">localhost</span><span class="o">:</span><span class="mi">80</span>
</pre></div>


<p>监听端口</p>
<div class="hlcode"><pre><span class="n">nc</span> <span class="o">-</span><span class="n">lp</span> <span class="n">localhost</span> <span class="mi">700</span>
<span class="n">socat</span> <span class="n">TCP</span><span class="o">-</span><span class="n">LISTEN</span><span class="o">:</span><span class="mi">700</span> <span class="o">-</span>
</pre></div>


<p>正向shell</p>
<div class="hlcode"><pre><span class="n">nc</span> <span class="o">-</span><span class="n">lp</span> <span class="n">localhost</span> <span class="mi">700</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">socat</span> <span class="n">TCP</span><span class="o">-</span><span class="n">LISTEN</span><span class="o">:</span><span class="mi">700</span> <span class="n">EXEC</span><span class="o">:/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>


<p>反弹shell</p>
<div class="hlcode"><pre><span class="n">nc</span> <span class="n">localhost</span> <span class="mi">700</span> <span class="o">-</span><span class="n">e</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">socat</span> <span class="n">tcp</span><span class="o">-</span><span class="n">connect</span><span class="o">:</span><span class="n">localhost</span><span class="o">:</span><span class="mi">700</span> <span class="n">exec</span><span class="o">:</span><span class="err">&#39;</span><span class="n">bash</span> <span class="o">-</span><span class="n">li</span><span class="err">&#39;</span><span class="p">,</span><span class="n">pty</span><span class="p">,</span><span class="n">stderr</span><span class="p">,</span><span class="n">setsid</span><span class="p">,</span><span class="n">sigint</span><span class="p">,</span><span class="n">sane</span>
</pre></div>


<h3 id="_3">代理与转发</h3>
<p>将本地80端口转发到远程的80端口</p>
<div class="hlcode"><pre><span class="n">socat</span> <span class="n">TCP</span><span class="o">-</span><span class="n">LISTEN</span><span class="o">:</span><span class="mi">80</span><span class="p">,</span><span class="n">fork</span> <span class="n">TCP</span><span class="o">:</span><span class="n">www</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">org</span><span class="o">:</span><span class="mi">80</span>
</pre></div>


<h3 id="ssl">SSL连接</h3>
<p>SSL服务器</p>
<div class="hlcode"><pre><span class="n">socat</span> <span class="n">OPENSSL</span><span class="o">-</span><span class="n">LISTEN</span><span class="o">:</span><span class="mi">443</span><span class="p">,</span><span class="n">cert</span><span class="o">=/</span><span class="n">cert</span><span class="p">.</span><span class="n">pem</span> <span class="o">-</span>
</pre></div>


<p>需要首先生成证书文件</p>
<p>SSL客户端</p>
<div class="hlcode"><pre><span class="n">socat</span> <span class="o">-</span> <span class="n">OPENSSL</span><span class="o">:</span><span class="n">localhost</span><span class="o">:</span><span class="mi">443</span>
</pre></div>


<h3 id="fork">fork服务器</h3>
<p>可以将一个使用标准输入输出的单进程程序变为一个使用fork方法的多进程服务</p>
<div class="hlcode"><pre><span class="n">socat</span> <span class="n">TCP</span><span class="o">-</span><span class="n">LISTEN</span><span class="o">:</span><span class="mi">1234</span><span class="p">,</span><span class="n">reuseaddr</span><span class="p">,</span><span class="n">fork</span> <span class="n">EXEC</span><span class="o">:</span><span class="p">.</span><span class="o">/</span><span class="n">helloworld</span>
</pre></div>


<h2 id="_4">参考</h2>
<ul>
<li><a href="http://brieflyx.me/2015/linux-tools/socat-introduction/">socat简介</a></li>
</ul>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2016 Elegancetse Tse.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://git.coding.net/tankywoo/yasimple_x2.git" target="_blank">YASimple_X2</a>.
        </p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>Site Generated 2016-12-03 14:25:31</p>
      </div> <!-- end footer-right -->
    </div>
  </body>
</html>